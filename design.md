# ロボットコントローラー仕様書 (RT-StackChan)

## 1. システム概要
ロボット（RT-StackChan）をソケット通信で遠隔操作するためのWebベースのコントローラーアプリケーション。
ユーザーはブラウザ上のインターフェースを通じて、ロボットの首振り（Pan/Tilt）、表情変更、発話を制御します。

## 2. アーキテクチャ
- **開発言語**: Python 3.x (uvで管理)
- **Webフレームワーク**: FastAPI (非同期処理・WebSocket対応のため採用)
- **フロントエンド**: HTML5, CSS3, JavaScript (Vanilla)
- **通信プロトコル**: TCP/IP Socket (コントローラーがクライアント、ロボットがサーバー)

## 3. 機能要件

### 3.1. 首振り制御 (Pan/Tilt)
- **入力**: UI上の操作エリア（2D平面）をクリックまたはドラッグ。
- **動作**: Pan（左右/Yaw）とTilt（上下/Pitch）の目標角度をリアルタイムに送信。
- **範囲**: 設定可能（例: Pan -90度〜+90度, Tilt -30度〜+30度）。

### 3.2. 表情変更
- **入力**: 表情リスト（例: 喜怒哀楽）からの選択。
- **動作**: ロボットのディスプレイ表示を変更するコマンドを送信。

### 3.3. 発話 (TTS)
- **入力**: テキスト入力フィールド + 送信ボタン。
- **動作**: 入力されたテキスト文字列を送信し、ロボット側で発話させる。

## 4. 通信プロトコル (決定版)
ESP32（ArduinoJson等）での解析を容易にするため、**JSON形式 (Line-delimited)** を採用します。
改行コード `\n` をデリミタとします。

**接続構成**:
- Robot: TCP Server (IP固定推奨)
- Controller: TCP Client

**コマンド仕様**:

1.  **移動 (Move)**
    ```json
    {"cmd": "move", "pan": 0.5, "tilt": -10.0}
    ```
    - `pan`: 左右角度 (float)
    - `tilt`: 上下角度 (float)

2.  **表情 (Expression)**
    ```json
    {"cmd": "face", "val": "happy"}
    ```
    - `val`: 表情ID (happy, sad, angry, sleepy, neutral)

3.  **発話 (Speak)**
    ```json
    {"cmd": "say", "val": "こんにちは"}
    ```
    - `val`: 発話テキスト (string)

## 5. UIデザイン
- **ヘッダー**: 接続設定（ロボットのIPアドレス・ポート番号）、接続ステータス表示。
- **メインエリア**:
    - **コントロールパッド**: 正方形の操作エリア。中心を(0,0)とし、マウス位置に応じて角度を計算。
    - **表情グリッド**: ワンクリックで表情送信。
    - **発話バー**: テキストボックスと送信ボタン。

## 6. 実装計画
1.  **プロジェクト初期化**: Python環境構築 (uv使用)、FastAPIインストール。
2.  **バックエンド実装**:
    - モックサーバー（ロボット役）の作成。
    - ロボットとのTCP通信クライアントの実装。
    - フロントエンド向けWebSocketエンドポイントの実装。
3.  **フロントエンド実装**:
    - 操作UI（HTML/CSS/JS）の作成。
    - WebSocket連携。
4.  **結合テスト**: 動作検証。
